import{a as P}from"./chunk-HTNIS4IB.js";import{$b as Y,Ab as H,Bb as w,Ea as N,Eb as R,Fa as l,Fb as M,Ga as d,Ha as f,I as O,Ia as k,Ib as z,Ma as B,O as A,Oa as q,Ob as D,P as V,Rb as L,Sb as x,T as C,Tb as W,U as S,Ub as Z,Vb as J,Wb as K,Xb as Q,Ya as E,Yb as U,Zb as X,_b as F,ab as $,ac as tt,ca as n,cb as G,cc as et,da as v,dc as it,ec as nt,fc as at,jc as rt,ka as u,la as j,lc as ot,ma as c,nc as lt,qa as r,ra as a,sa as _,wa as b,xa as y,ya as m,za as I}from"./chunk-25PIQWJN.js";import"./chunk-P2VZOJAX.js";function _t(e,p){if(e&1&&(r(0,"small",14),l(1),a()),e&2){let t=m();n(),f(" ",t.i18n.translate("activities.name")," is required ")}}function yt(e,p){if(e&1&&(r(0,"small",14),l(1),a()),e&2){let t=m();n(),f(" ",t.i18n.translate("activities.description")," is required ")}}function ht(e,p){if(e&1&&(r(0,"small",14),l(1),a()),e&2){let t=m();n(),f(" ",t.i18n.translate("activities.safeValue")," is required ")}}var T=(()=>{class e{fb;ref;config;activityService;messageService;i18n;activityForm;parentActivities=[];isEditMode=!1;saving=!1;constructor(t,o,i,s,g,h){this.fb=t,this.ref=o,this.config=i,this.activityService=s,this.messageService=g,this.i18n=h}ngOnInit(){let t=this.config.data?.activity;this.isEditMode=!!t,this.loadParentActivities(),this.activityForm=this.fb.group({name:[t?.name||"",x.required],description:[t?.description||"",x.required],safeValue:[t?.safeValue||0,[x.required,x.min(0),x.max(100)]],parentActivityId:[t?.parentActivityId||null]})}loadParentActivities(){this.activityService.getAllActivities().subscribe({next:t=>{if(t.status&&t.data){let o=this.config.data?.activity?.id;this.parentActivities=t.data.filter(i=>i.id!==o)}},error:t=>{console.error("Error loading parent activities:",t),this.messageService.add({severity:"warn",summary:"Warning",detail:"Failed to load parent activities"})}})}onSubmit(){if(this.activityForm.valid){this.saving=!0;let t={name:this.activityForm.value.name,description:this.activityForm.value.description,safeValue:this.activityForm.value.safeValue,parentActivityId:this.activityForm.value.parentActivityId||null};(this.isEditMode?this.activityService.updateActivity(this.config.data.activity.id,t):this.activityService.createActivity(t)).subscribe({next:i=>{let s=i.data||i;this.messageService.add({severity:"success",summary:"Success",detail:`Activity ${this.isEditMode?"updated":"created"} successfully`}),this.saving=!1,this.ref.close(s)},error:i=>{this.saving=!1;let s=i.error?.message||`Failed to ${this.isEditMode?"update":"create"} activity`;this.messageService.add({severity:"error",summary:"Error",detail:s}),console.error("Error saving activity:",i)}})}}static \u0275fac=function(o){return new(o||e)(v(U),v(nt),v(it),v(P),v(M),v(w))};static \u0275cmp=A({type:e,selectors:[["app-activity-dialog"]],decls:29,vars:27,consts:[[1,"activity-dialog",3,"dir"],[1,"activity-form",3,"ngSubmit","formGroup"],[1,"form-grid"],[1,"form-field","full-width"],["pInputText","","formControlName","name",1,"w-full",3,"placeholder"],["class","p-error",4,"ngIf"],["pInputTextarea","","formControlName","description",1,"w-full",3,"rows","placeholder"],[1,"form-field"],["formControlName","safeValue","suffix","%",1,"w-full",3,"min","max","minFractionDigits","maxFractionDigits","showButtons"],["formControlName","parentActivityId","optionLabel","name","optionValue","id","filterBy","name",1,"w-full",3,"options","placeholder","showClear","filter"],[1,"form-hint"],[1,"form-actions"],["pButton","","type","button",1,"p-button-secondary",3,"click","label"],["pButton","","type","submit",3,"label","disabled","loading"],[1,"p-error"]],template:function(o,i){if(o&1&&(r(0,"div",0)(1,"h3"),l(2),a(),r(3,"form",1),y("ngSubmit",function(){return i.onSubmit()}),r(4,"div",2)(5,"div",3)(6,"label"),l(7),a(),_(8,"input",4),u(9,_t,2,1,"small",5),a(),r(10,"div",3)(11,"label"),l(12),a(),_(13,"textarea",6),u(14,yt,2,1,"small",5),a(),r(15,"div",7)(16,"label"),l(17),a(),_(18,"p-inputNumber",8),u(19,ht,2,1,"small",5),a(),r(20,"div",7)(21,"label"),l(22),a(),_(23,"p-dropdown",9),r(24,"small",10),l(25),a()()(),r(26,"div",11)(27,"button",12),y("click",function(){return i.ref.close()}),a(),_(28,"button",13),a()()()),o&2){let s,g,h;c("dir",i.i18n.getCurrentLanguage()==="ar"?"rtl":"ltr"),n(2),d(i.isEditMode?i.i18n.translate("activities.edit"):i.i18n.translate("activities.add")),n(),c("formGroup",i.activityForm),n(4),f("",i.i18n.translate("activities.name")," *"),n(),c("placeholder",i.i18n.translate("activities.name")),n(),c("ngIf",((s=i.activityForm.get("name"))==null?null:s.hasError("required"))&&((s=i.activityForm.get("name"))==null?null:s.touched)),n(3),f("",i.i18n.translate("activities.description")," *"),n(),c("rows",4)("placeholder",i.i18n.translate("activities.description")),n(),c("ngIf",((g=i.activityForm.get("description"))==null?null:g.hasError("required"))&&((g=i.activityForm.get("description"))==null?null:g.touched)),n(3),f("",i.i18n.translate("activities.safeValue")," *"),n(),c("min",0)("max",100)("minFractionDigits",2)("maxFractionDigits",2)("showButtons",!0),n(),c("ngIf",((h=i.activityForm.get("safeValue"))==null?null:h.hasError("required"))&&((h=i.activityForm.get("safeValue"))==null?null:h.touched)),n(3),d(i.i18n.translate("activities.parentActivity")),n(),c("options",i.parentActivities)("placeholder",i.i18n.translate("activities.selectParent"))("showClear",!0)("filter",!0),n(2),d(i.i18n.translate("activities.parentActivityHint")),n(2),I("label",i.i18n.translate("common.cancel")),n(),I("label",i.i18n.translate("common.save")),c("disabled",i.activityForm.invalid||i.saving)("loading",i.saving)}},dependencies:[E,J,L,W,Z,K,Q,D,F,Y,tt,rt],styles:[".activity-dialog[_ngcontent-%COMP%]{padding:1.5rem;min-width:600px}.activity-dialog[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:1.5rem;font-weight:600}.activity-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}.form-field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-field.full-width[_ngcontent-%COMP%]{grid-column:1 / -1}.form-field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;color:#333}.form-hint[_ngcontent-%COMP%]{color:#666;font-size:.85rem;font-style:italic}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.5rem;margin-top:1rem;padding-top:1rem;border-top:1px solid #e0e0e0}.w-full[_ngcontent-%COMP%]{width:100%}[dir=rtl][_ngcontent-%COMP%]   .form-actions[_ngcontent-%COMP%]{justify-content:flex-start}[dir=rtl][_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]{text-align:right}@media (max-width: 768px){.activity-dialog[_ngcontent-%COMP%]{min-width:auto;width:100%}.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})}return e})();var xt=()=>["name","description"];function Ct(e,p){if(e&1){let t=b();r(0,"button",10),y("click",function(){C(t);let i=m();return S(i.openAddDialog())}),a()}if(e&2){let t=m();I("label",t.i18n.translate("activities.add"))}}function St(e,p){if(e&1){let t=b();r(0,"div",11)(1,"span",12),_(2,"i",13),r(3,"input",14),y("input",function(i){C(t),m();let s=N(8);return S(s.filterGlobal(i.target.value,"contains"))}),a()()()}if(e&2){let t=m();n(3),c("placeholder",t.i18n.translate("common.search"))}}function bt(e,p){if(e&1&&(r(0,"th"),l(1),a()),e&2){let t=m(2);n(),d(t.i18n.translate("common.edit"))}}function It(e,p){if(e&1&&(r(0,"th"),l(1),a()),e&2){let t=m(2);n(),d(t.i18n.translate("common.delete"))}}function At(e,p){if(e&1&&(r(0,"tr")(1,"th"),l(2),a(),r(3,"th"),l(4),a(),r(5,"th"),l(6),a(),r(7,"th"),l(8),a(),u(9,bt,2,1,"th",15)(10,It,2,1,"th",15),a()),e&2){let t=m();n(2),d(t.i18n.translate("activities.name")),n(2),d(t.i18n.translate("activities.description")),n(2),d(t.i18n.translate("activities.safeValue")),n(2),d(t.i18n.translate("activities.parentActivity")),n(),c("ngIf",t.canEdit()),n(),c("ngIf",t.canDelete())}}function Et(e,p){if(e&1&&(r(0,"span"),l(1),a()),e&2){let t=m().$implicit;n(),d(t.parentActivity.name)}}function wt(e,p){e&1&&(r(0,"span",17),l(1,"-"),a())}function Mt(e,p){if(e&1){let t=b();r(0,"td")(1,"button",18),y("click",function(){C(t);let i=m().$implicit,s=m();return S(s.openEditDialog(i))}),a()()}}function Dt(e,p){if(e&1){let t=b();r(0,"td")(1,"button",19),y("click",function(){C(t);let i=m().$implicit,s=m();return S(s.deleteActivity(i))}),a()()}}function Ft(e,p){if(e&1&&(r(0,"tr")(1,"td"),l(2),a(),r(3,"td"),l(4),a(),r(5,"td"),l(6),B(7,"number"),a(),r(8,"td"),u(9,Et,2,1,"span",15)(10,wt,2,0,"span",16),a(),u(11,Mt,2,0,"td",15)(12,Dt,2,0,"td",15),a()),e&2){let t=p.$implicit,o=m();n(2),d(t.name),n(2),d(t.description),n(2),f("",q(7,7,t.safeValue,"1.2-2"),"%"),n(3),c("ngIf",t.parentActivity),n(),c("ngIf",!t.parentActivity),n(),c("ngIf",o.canEdit()),n(),c("ngIf",o.canDelete())}}function Pt(e,p){if(e&1&&(r(0,"tr")(1,"td",20),l(2),a()()),e&2){let t=m();n(),j("colspan",t.canEdit()?6:4),n(),f(" ",t.i18n.translate("common.noData")," ")}}var st=(()=>{class e{activityService;messageService;confirmationService;dialogService;i18n;activities=[];loading=!1;ref;constructor(t,o,i,s,g){this.activityService=t,this.messageService=o,this.confirmationService=i,this.dialogService=s,this.i18n=g}ngOnInit(){this.loadActivities()}loadActivities(){this.loading=!0,this.activityService.getAllActivities().subscribe({next:t=>{t.status&&t.data?this.activities=t.data:(this.messageService.add({severity:"warn",summary:"Warning",detail:t.message||"Failed to load activities"}),this.activities=[]),this.loading=!1},error:t=>{this.loading=!1,this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load activities. Please check your API connection."}),console.error("Error loading activities:",t)}})}openAddDialog(){this.ref=this.dialogService.open(T,{header:this.i18n.translate("activities.add"),width:"70%",contentStyle:{"max-height":"90vh",overflow:"auto"},baseZIndex:1e4,data:{activity:null}}),this.ref.onClose.subscribe(t=>{t&&this.loadActivities()})}openEditDialog(t){this.ref=this.dialogService.open(T,{header:this.i18n.translate("activities.edit"),width:"70%",contentStyle:{"max-height":"90vh",overflow:"auto"},baseZIndex:1e4,data:{activity:t}}),this.ref.onClose.subscribe(o=>{o&&this.loadActivities()})}deleteActivity(t){this.confirmationService.confirm({message:`Are you sure you want to delete "${t.name}"?`,header:"Confirm Delete",icon:"pi pi-exclamation-triangle",accept:()=>{this.activityService.deleteActivity(t.id).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Success",detail:"Activity deleted successfully"}),this.loadActivities()},error:o=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to delete activity"}),console.error("Error deleting activity:",o)}})}})}canEdit(){return!0}canDelete(){return!0}static \u0275fac=function(o){return new(o||e)(v(P),v(M),v(R),v(at),v(w))};static \u0275cmp=A({type:e,selectors:[["app-activities"]],decls:13,vars:9,consts:[["dt",""],[1,"activities-container"],[1,"p-toolbar-group-start"],[1,"p-toolbar-group-end"],["pButton","","icon","pi pi-plus",3,"label","click",4,"ngIf"],["styleClass","p-datatable-striped",3,"value","paginator","rows","globalFilterFields","loading","rowHover"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pButton","","icon","pi pi-plus",3,"click","label"],[1,"table-header"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text",3,"input","placeholder"],[4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"text-muted"],["pButton","","icon","pi pi-pencil",1,"p-button-rounded","p-button-text",3,"click"],["pButton","","icon","pi pi-trash",1,"p-button-rounded","p-button-text","p-button-danger",3,"click"],[1,"text-center"]],template:function(o,i){o&1&&(r(0,"div",1)(1,"p-toolbar")(2,"div",2)(3,"h2"),l(4),a()(),r(5,"div",3),u(6,Ct,1,1,"button",4),a()(),r(7,"p-table",5,0),u(9,St,4,1,"ng-template",6)(10,At,11,6,"ng-template",7)(11,Ft,13,10,"ng-template",8)(12,Pt,3,2,"ng-template",9),a()()),o&2&&(n(4),d(i.i18n.translate("activities.title")),n(2),c("ngIf",i.canEdit()),n(),c("value",i.activities)("paginator",!0)("rows",10)("globalFilterFields",k(8,xt))("loading",i.loading)("rowHover",!0))},dependencies:[E,D,z,F,et,ot,$],styles:[".activities-container[_ngcontent-%COMP%], [dir=rtl][_ngcontent-%COMP%]   .activities-container[_ngcontent-%COMP%], [dir=ltr][_ngcontent-%COMP%]   .activities-container[_ngcontent-%COMP%]{padding:2rem}.table-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}[dir=rtl][_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%]{flex-direction:row-reverse}.text-muted[_ngcontent-%COMP%]{color:#999;font-style:italic}.text-center[_ngcontent-%COMP%]{text-align:center;padding:2rem}"]})}return e})();var Kt=(()=>{class e{static \u0275fac=function(o){return new(o||e)};static \u0275mod=V({type:e});static \u0275inj=O({imports:[G,X,lt,H.forChild([{path:"",component:st}])]})}return e})();export{Kt as ActivitiesModule};
